file(GLOB HEADERS "include/steemit/manifest/*.hpp")

################# external plugins ###################

# external_plugins target depends on all plugins
add_library( steemit_external_plugins
   external_plugins.cpp
   )

# generate file based on comments
file(WRITE "${CMAKE_CURRENT_BINARY_DIR}/inc/mf_external_plugins.inc" "// this file is autogenerated\n#pragma once\n#define STEEMIT_EXTERNAL_PLUGIN_LIST \\\n   ")

foreach(pin $ENV{STEEMIT_EXTERNAL_PLUGINS})
   file(APPEND "${CMAKE_CURRENT_BINARY_DIR}/inc/mf_external_plugins.inc" "( ${pin} )")
   target_link_libraries( steemit_external_plugins "${pin}" )
endforeach()

file(APPEND "${CMAKE_CURRENT_BINARY_DIR}/inc/mf_external_plugins.inc" "\n")

################# internal plugins ###################

add_library( steemit_internal_plugins
   internal_plugins.cpp
   )

file(WRITE "${CMAKE_CURRENT_BINARY_DIR}/inc/mf_internal_plugins.inc" "// this file is autogenerated\n#pragma once\n#define STEEMIT_INTERNAL_PLUGIN_LIST \\\n   ")

foreach(pin $ENV{STEEMIT_INTERNAL_PLUGINS})
   file(APPEND "${CMAKE_CURRENT_BINARY_DIR}/inc/mf_internal_plugins.inc" "( ${pin} )")
   target_link_libraries( steemit_internal_plugins "steemit_${pin}" )
endforeach()

file(APPEND "${CMAKE_CURRENT_BINARY_DIR}/inc/mf_internal_plugins.inc" "\n")

################# common ###################

add_library( steemit_mf_plugins
   mf_plugins.cpp
   ${HEADERS}
   ${CMAKE_CURRENT_BINARY_DIR}/inc/mf_internal_plugins.inc
   ${CMAKE_CURRENT_BINARY_DIR}/inc/mf_external_plugins.inc
   )

target_include_directories( steemit_mf_plugins
   PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/include"
   PRIVATE "${CMAKE_CURRENT_BINARY_DIR}/inc" )

INSTALL( TARGETS
   steemit_mf_plugins

   RUNTIME DESTINATION bin
   LIBRARY DESTINATION lib
   ARCHIVE DESTINATION lib
)
